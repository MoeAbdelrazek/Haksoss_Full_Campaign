<section id="funnels" class="budget-section">
  <h2 class="section-title">High-Value Conversion Funnels — Data-Driven Insights</h2>
  <p class="section-intro">
    A data-focused visualization of the user journey from awareness → consideration → conversion → retention → advocacy. Metrics are traced from raw data and refined through micro-tests, CRM, POS, and GA4 validation.
  </p>

  <div class="charts-grid">
    <!-- Funnel Chart -->
    <div class="chart-box" style="grid-column:1/-1;">
      <h3>User Funnel Overview</h3>
      <canvas id="funnelChart"></canvas>
      <p style="margin-top:12px; font-size:16px; color:#6b4f44;">
        Funnel stages trace unique users, engagement, conversions, and retention. Each stage is validated via multi-source data.
      </p>
    </div>

    <!-- Funnel Metrics Cards -->
    <div class="chart-box">
      <h3>Awareness</h3>
      <p style="font-size:22px; margin:10px 0;">
        <span style="color:#FFD700;">&#128064;</span> 80,800 users
      </p>
      <p class="muted">+8% vs original target 75,000</p>
    </div>

    <div class="chart-box">
      <h3>Consideration</h3>
      <p style="font-size:22px; margin:10px 0;">
        <span style="color:#FFD700;">&#128241;</span> 11.3% engagement rate
      </p>
      <p class="muted">Weighted average across IG/TikTok & short-form videos</p>
    </div>

    <div class="chart-box">
      <h3>Conversion</h3>
      <p style="font-size:22px; margin:10px 0;">
        <span style="color:#FFD700;">&#128200;</span> 6.2% conversion • 1,070 loyalty sign-ups
      </p>
      <p class="muted">GA4 + CRM deduped events; includes validated in-store promo sign-ups</p>
    </div>

    <div class="chart-box">
      <h3>Retention</h3>
      <p style="font-size:22px; margin:10px 0;">
        <span style="color:#FFD700;">&#128101;</span> 15% repeat purchases
      </p>
      <p class="muted">Members with ≥1 visit within 30–60 days; POS mapped</p>
    </div>

    <div class="chart-box">
      <h3>Advocacy</h3>
      <p style="font-size:22px; margin:10px 0;">
        <span style="color:#FFD700;">&#128279;</span> 15% referral uplift
      </p>
      <p class="muted">Tracked via referral codes & A/B control testing</p>
    </div>
  </div>

  <h3 class="section-subtitle">Key Funnel Insights</h3>
  <ul class="insights-list">
    <li>Reels + hero visuals drove awareness efficiently among 20–35-year-olds.</li>
    <li>High-intent Google search users were 2x more likely to convert than display audiences.</li>
    <li>Form friction reduction (5 → 3 fields) improved completion rate by 19%.</li>
    <li>VIP incentives increased repeat purchases by 28% within 30 days.</li>
    <li>Morning-hour targeting (6:00–10:30) improved conversion and lowered CPA.</li>
  </ul>
</section>

<style>
  .budget-section {
    background: linear-gradient(145deg, #fdf5ed, #fceedd);
    border-radius: 20px;
    padding: 50px 40px;
    max-width: 1200px;
    margin: 60px auto;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    font-family: "Times New Roman", serif;
    color: #5a3e36;
  }

  .section-title { font-size:32px; text-align:center; margin-bottom:30px; }
  .section-intro { font-size:18px; max-width:900px; margin:0 auto 40px; text-align:center; }
  .charts-grid {
    display:grid; grid-template-columns:repeat(auto-fit, minmax(300px,1fr)); gap:30px; margin-bottom:40px;
  }
  .chart-box {
    background-color:#f5e6d0; padding:25px 20px; border-radius:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1);
    text-align:center; transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .chart-box:hover { transform:translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.15); }
  .chart-box h3 { font-size:22px; margin-bottom:15px; }
  .insights-list li { font-size:20px; margin-bottom:12px; }
  .muted { color:#6b4f44; font-size:14px; }
  @media (max-width:768px){ .charts-grid{ grid-template-columns:1fr; } }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script>
  const funnelCtx = document.getElementById('funnelChart').getContext('2d');
  new Chart(funnelCtx, {
    type: 'bar',
    data: {
      labels: ['Awareness','Consideration','Conversion','Retention','Advocacy'],
      datasets: [{
        label: 'Users / %',
        data: [80800, 9150, 1070, 161, 24],
        backgroundColor: ['#FFD700','#F3C06B','#C19A6B','#D6A557','#BFA76E'],
        borderRadius: 12
      }]
    },
    options: {
      indexAxis: 'y',
      responsive:true,
      plugins: {
        legend:{ display:false },
        datalabels:{
          anchor:'end',
          align:'right',
          color:'#5a3e36',
          font:{ weight:'bold', size:14 },
          formatter: (value) => value.toLocaleString()
        }
      },
      animation: {
        duration: 2000,
        easing: 'easeOutQuart',
        onProgress: (animation) => {
          // staggered fill effect
          funnelCtx.data.datasets[0].backgroundColor.forEach((color, i)=>{
            funnelCtx.data.datasets[0].backgroundColor[i] = i <= animation.currentStep/40 ? color : '#e0d2c2';
          });
        }
      },
      scales: {
        x: { beginAtZero:true },
        y: { ticks:{ font:{ size:14 } } }
      }
    },
    plugins: [ChartDataLabels]
  });
</script>
